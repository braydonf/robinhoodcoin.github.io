<!DOCTYPE html>
<html>
  <head>
    <title>List of Elites</title>
    <link rel='stylesheet' href='./assets/css/style.css' />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./assets/javascript/application.js"></script>
    <script src="./assets/javascript/web3.min.js"></script>
  </head>
  <h2>Elites Scoreboard</h2>
  <p>The table contains a list of addresses and the time they reached <code>elite</code> status.</p>
    <body>
      <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" onclick="loadContract('rinkeby')">Rinkeby</a></li>
        <li><a data-toggle="tab" onclick="loadContract('mainnet')">Livenet</a></li>
      </ul>
      <br />
      <div id="none">There are no elites...</div>
      <table id="elitesTable" style="display:'none';"class="table table-bordered table-hover table-sm">
        <thead>
          <tr>
            <th>Address</th>
            <th>Time</th>
          </tr>
        </thead>
        <tbody id="elitesTableBody">
        </tbody>
      </table>
    </body>
    <br />
    <footer>
      <a href="./contract.html">Contract</a> | <a href="./howto.html">Getting Started</a> | <a href="https://github.com/robinhoodcoin/RobinhoodCoin">Source</a> | <a href="./functions.html">API</a> | <a href="./developers.html">Developers</a><br />
    </footer>
</html>

<script>
var Web3 = require("web3");
window.onload = loadContract('rinkeby');

function loadContract(network) {
    if (network == "rinkeby") {
      var contractJson = rinkeby.json;
      var contractAddress = rinkeby.address;
      var provider = 'https://rinkeby.infura.io/';
    } else if (network == "mainnet") {
      var contractJson = livenet.json;
      var contractAddress = livenet.address;
      var provider = 'https://mainnet.infura.io/';
    } else {
      return;
    }

    $("#elitesTable > tbody").html("");
    document.getElementById('elitesTable').style.display = 'none';
    document.getElementById('none').style.display = '';

    var table = document.getElementById('elitesTable').getElementsByTagName('tbody')[0];
    var web3 = new Web3(new Web3.providers.HttpProvider(provider));
    var MyContract = web3.eth.contract(JSON.parse(contractJson));
    var myContractInstance = MyContract.at(contractAddress);
    var elitesCount = myContractInstance.getElitesCount.call();

    if (elitesCount <= 0) {
      return;
    }

    document.getElementById('elitesTable').style.display = '';
    document.getElementById('none').style.display = 'none';

    for (var i = 0; i < elitesCount; i++) {
        var elite = myContractInstance.elites.call(i);
        var eliteTime = myContractInstance.elitesTime.call(elite);

        var newRow = table.insertRow(i);
        var newCell  = newRow.insertCell(0);
        var newText  = document.createTextNode(elite);
        newCell.appendChild(newText);

        newCell  = newRow.insertCell(1);
        newText  = document.createTextNode(eliteTime);
        newCell.appendChild(newText);
    }
}

</script>
